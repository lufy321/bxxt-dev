"use strict";(self["webpackChunkbxxt"]=self["webpackChunkbxxt"]||[]).push([[234],{5705:function(e,a,t){t.d(a,{FA:function(){return u},Rl:function(){return i},wr:function(){return n}});var l=t(7707);function i(){return(0,l.W)({url:"/my/getOption"})}function n(){return(0,l.W)({url:"/my/getMaterialOption"})}function u(){return(0,l.W)({url:"/my/getSiteOption"})}},8292:function(e,a,t){function l(){var e=new Date,a=e.getFullYear(),t=e.getMonth()+1;t=t>=10?t:"0"+t;var l=e.getDate();l=l>=10?l:"0"+l;var i=e.getHours();i=i>=10?i:"0"+i;var n=e.getMinutes();n=n>=10?n:"0"+n;var u=e.getSeconds();return u=u>=10?u:"0"+u,a+"-"+t+"-"+l+" "+i+":"+n+":"+u}t.d(a,{p:function(){return l}})},5441:function(e,a,t){t.r(a),t.d(a,{default:function(){return C}});var l=t(6252);const i={class:"detail"},n=(0,l.Uk)("详情"),u={class:"detail-body"},o={class:"upimg-list"},r={class:"upimg-list"},m={key:2,style:{margin:"16px"}},s=(0,l.Uk)(" 接单 "),d={key:3,style:{margin:"16px"}},c=(0,l.Uk)(" 处理完成 ");function p(e,a,t,p,f,v){const D=(0,l.up)("nav-bar"),g=(0,l.up)("van-cell"),w=(0,l.up)("van-cell-group"),h=(0,l.up)("van-image"),W=(0,l.up)("van-field"),k=(0,l.up)("van-cascader"),b=(0,l.up)("van-popup"),y=(0,l.up)("van-uploader"),M=(0,l.up)("van-button"),U=(0,l.up)("van-form");return(0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(D,null,{left:(0,l.w5)((()=>[])),default:(0,l.w5)((()=>[n])),_:1}),(0,l._)("div",u,[(0,l.Wm)(w,{inset:"",class:"repairs-info"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{title:"报修信息"}),(0,l.Wm)(g,{title:"单号",value:e.formData.id},null,8,["value"]),(0,l.Wm)(g,{title:"姓名",value:e.formData.name},null,8,["value"]),(0,l.Wm)(g,{title:"工号",value:e.formData.repairsUser},null,8,["value"]),(0,l.Wm)(g,{title:"电话",value:e.formData.tel},null,8,["value"]),(0,l.Wm)(g,{title:"提报时间",value:e.formData.createTime},null,8,["value"]),(0,l.Wm)(g,{title:"报修项",value:e.formData.reportContent},null,8,["value"]),(0,l.Wm)(g,{title:"地点",value:e.formData.dormitory},null,8,["value"]),(0,l.Wm)(g,{title:"故障描述",value:e.formData.message},null,8,["value"])])),_:1}),(0,l.Wm)(w,{inset:"",class:"flow-info"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{title:"报修图片"}),(0,l._)("div",o,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(p.imageList,((e,a)=>((0,l.wg)(),(0,l.j4)(h,{key:e,width:"100",height:"100",src:e,"lazy-load":"",onClick:e=>p.sceneImg(a)},null,8,["src","onClick"])))),128))])])),_:1}),(0,l.Wm)(w,{inset:"",class:"repairs-info"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{title:"维修信息"}),(0,l.Wm)(g,{title:"工号",value:e.formData.pickUser},null,8,["value"]),(0,l.Wm)(g,{title:"接单时间",value:e.formData.acceptTime},null,8,["value"]),(0,l.Wm)(g,{title:"完成时间",value:e.formData.endTime},null,8,["value"]),(0,l.Wm)(g,{title:"维修材料",value:e.formData.usedMaterial},null,8,["value"]),(0,l.Wm)(g,{title:"材料备注",value:e.formData.usedDetail},null,8,["value"])])),_:1}),(0,l.Wm)(U,{onSubmit:p.onSubmit},{default:(0,l.w5)((()=>[2===e.formData.staus?((0,l.wg)(),(0,l.j4)(w,{key:0,inset:"",class:"flow-info"},{default:(0,l.w5)((()=>[(0,l.Wm)(g,{title:"维修图片"}),(0,l._)("div",r,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(p.repairImageList,((e,a)=>((0,l.wg)(),(0,l.j4)(h,{key:e,width:"100",height:"100",src:e,"lazy-load":"",onClick:e=>p.sceneRepairImage(a)},null,8,["src","onClick"])))),128))])])),_:1})):(0,l.kq)("",!0),1===e.formData.staus&&0==e.user.identity?((0,l.wg)(),(0,l.j4)(w,{key:1,inset:"",class:"flow-info"},{default:(0,l.w5)((()=>[(0,l.Wm)(W,{modelValue:e.updateFormData.usedMaterial,"onUpdate:modelValue":a[0]||(a[0]=a=>e.updateFormData.usedMaterial=a),"is-link":"",readonly:"",label:"使用材料",placeholder:"请选择使用材料",onClick:a[1]||(a[1]=e=>p.showMaterial=!0),rules:[{required:!0,message:"请选择您使用的材料"}]},null,8,["modelValue"]),(0,l.Wm)(W,{modelValue:e.updateFormData.usedDetail,"onUpdate:modelValue":a[2]||(a[2]=a=>e.updateFormData.usedDetail=a),name:"材料备注",label:"材料备注",placeholder:"具体使用材料"},null,8,["modelValue"]),(0,l.Wm)(b,{show:p.showMaterial,"onUpdate:show":a[5]||(a[5]=e=>p.showMaterial=e),round:"",position:"bottom"},{default:(0,l.w5)((()=>[(0,l.Wm)(k,{modelValue:p.materialItem,"onUpdate:modelValue":a[3]||(a[3]=e=>p.materialItem=e),title:"请选择使用的材料",options:p.materialOptions,onClose:a[4]||(a[4]=e=>p.showMaterial=!1),onFinish:p.onFinishMaterial},null,8,["modelValue","options","onFinish"])])),_:1},8,["show"]),(0,l.Wm)(y,{class:"upload",modelValue:p.fileList,"onUpdate:modelValue":a[6]||(a[6]=e=>p.fileList=e),multiple:""},null,8,["modelValue"])])),_:1})):(0,l.kq)("",!0),0===e.formData.staus&&0==e.user.identity?((0,l.wg)(),(0,l.iD)("div",m,[(0,l.Wm)(M,{round:"",block:"",type:"primary",color:"#44b883",onClick:p.acceptSubmit},{default:(0,l.w5)((()=>[s])),_:1},8,["onClick"])])):1===e.formData.staus&&0==e.user.identity?((0,l.wg)(),(0,l.iD)("div",d,[(0,l.Wm)(M,{round:"",block:"",type:"primary",color:"#44b883","native-type":"submit"},{default:(0,l.w5)((()=>[c])),_:1})])):(0,l.kq)("",!0)])),_:1},8,["onSubmit"])])])}t(2687);var f=t(9370),v=(t(8479),t(8274)),D=(t(1958),t(368),t(6742),t(7179),t(2939),t(6196),t(2666),t(9137),t(1088),t(6300),t(1626)),g=D.e,w=t(3204),h=t(4454),W=t(5705),k=t(2119),b=t(2262),y=t(381),M=t.n(y),U=t(3907),F=t(8292),H={name:"Detail",components:{NavBar:w.Z},setup(){const e=(0,U.oR)();let a=(0,b.qj)({formData:{},updateFormData:{endImagesUrl:"",usedMaterial:"",endTime:"",usedDetail:"",id:"",pickUser:""}});const t=(0,k.yj)(),i=(0,k.tv)();let n=(0,b.iH)(0);n.value=t.query.id,a.updateFormData.id=n;const u=(0,b.iH)(""),o=(0,b.iH)(!1);let r=(0,b.iH)([]);const m=({selectedOptions:e})=>{o.value=!1,a.updateFormData.usedMaterial=e.map((e=>e.text)).join("/")};let s=(0,b.iH)([]),d=(0,b.iH)([]);const c=(0,b.iH)([]);let p=(0,b.iH)("");const D=e=>{g({images:s.value,startPosition:e})},w=e=>{g({images:d.value,startPosition:e})};(0,l.bv)((()=>{(0,h.Nm)(n.value).then((e=>{a.formData=e.data,a.formData["createTime"]=M()(a.formData["createTime"]).format("YYYY-MM-DD HH:mm"),a.formData["acceptTime"]&&(a.formData["acceptTime"]=M()(a.formData["acceptTime"]).format("YYYY-MM-DD HH:mm")),a.formData["endTime"]&&(a.formData["endTime"]=M()(a.formData["endTime"]).format("YYYY-MM-DD HH:mm")),a.formData["endImagesUrl"]&&(d.value=a.formData.endImagesUrl.split(",")),a.formData["imagesUrl"]&&(s.value=a.formData.imagesUrl.split(","))})),(0,W.wr)().then((({data:e})=>{r.value=e}))}));const y=()=>{v.Z.loading({duration:0,message:"接单中...",forbidClick:!0});const a=(0,b.qj)({id:n.value,acceptTime:(0,F.p)(),pickUser:e.state.user.username});(0,h.Yb)(a).then((e=>{})),(0,h.fP)(1,n.value).then((e=>{v.Z.clear(),v.Z.success("接单成功！"),i.replace({path:"/show"})}))},H=()=>{let t=new FormData;for(let e=0;e<c.value.length;e++)t.append("images",c.value[e].file);f.Z.confirm({title:"确认提交",message:"是否确认提交，一旦提交无法撤回！"}).then((async()=>{v.Z.loading({duration:0,message:"提交中...",forbidClick:!0}),await(0,h.d0)(t).then((({data:a})=>{for(let t=0;t<a.length;t++)p.value+=a[t].destination.replace(".",e.state.baseUrl)+"/"+a[t].filename+",";p.value.length>0&&(p.value=p.value.substr(0,p.value.length-1)),console.log(p.value)})),a.updateFormData["endImagesUrl"]=p.value,a.updateFormData["endTime"]=(0,F.p)(),(0,h.xM)(a.updateFormData).then((e=>{(0,h.fP)(2,n.value).then((e=>{v.Z.clear(),v.Z.success("提交完成！"),i.replace({path:"/show"})}))})).catch((()=>{v.Z.clear(),v.Z.fail("提交失败！")}))}))};return{materialItem:u,showMaterial:o,onFinishMaterial:m,materialOptions:r,...(0,b.BK)(a),...(0,b.BK)(e.state),onSubmit:H,acceptSubmit:y,imageList:s,repairImageList:d,sceneImg:D,sceneRepairImage:w,fileList:c}}},Y=t(3744);const T=(0,Y.Z)(H,[["render",p]]);var C=T}}]);
//# sourceMappingURL=234.535196f8.js.map